function hdl = neuRoiGui()
hdl.mainFig= figure('Position',[80,5,550,650],'Resize','off');%JE second value to 5 so the top is on screen
set(hdl.mainFig,'MenuBar','none');
set(hdl.mainFig,'ToolBar','none');
set(hdl.mainFig,'Name','neuRoi','NumberTitle','off');
hdl.fileMenu = uimenu(hdl.mainFig,'Text','File');
hdl.loadExpMenu = uimenu(hdl.fileMenu,'Text',....
                             'Open Experiment','Accelerator','O');
hdl.newExpMenu = uimenu(hdl.fileMenu,'Text',....
                        'New Experiment','Accelerator','N');

hdl.saveExpMenu = uimenu(hdl.fileMenu,'Text',....
                        'Save Experiment','Accelerator','S');
GeneralBotOffset = 30;

expInfoBotPos = 515+GeneralBotOffset;

hdl.expInfoPanel = uipanel('Units', 'pixels', ...
                           'Position', [10  expInfoBotPos   200   80]);
hdl.frameRateText = uicontrol(hdl.expInfoPanel,...
                              'Style','text',...
                              'String','Frame rate',...
                              'Position',[0   50    100    25]);

hdl.frameRateEdit = uicontrol(hdl.expInfoPanel,...
                              'Style','edit',...
                              'String','30',...
                              'Position',[120 50 60 25]);

hdl.nPlaneText = uicontrol(hdl.expInfoPanel,...
                              'Style','text',...
                              'String','Total no. planes',...
                              'Position',[0   20    120    25]);

hdl.nPlaneEdit = uicontrol(hdl.expInfoPanel,...
                              'Style','edit',...
                              'String','1',...
                              'Position',[120 20 60 25]);

loadRangePos = 450+GeneralBotOffset;

hdl.loadRangeHeadline = uicontrol(hdl.mainFig,'Style','text',...
                             'String','Load range',...
                             'Position', [25  loadRangePos+10 100 50],...
                             'FontWeight','bold');

hdl.loadRangeGroup = uibuttongroup('Units','pixels',...
                                   'Position', [25 loadRangePos-20 150 60]);

hdl.loadRangeButton1 = uicontrol(hdl.loadRangeGroup,...
                                 'Style','radiobutton',...
                                 'String','Load all',...
                                 'Value',1,...
                                 'Tag','loadrange_radiobutton_1',...
                                 'Position',[0 40 100 20]);

hdl.loadRangeButton2 = uicontrol(hdl.loadRangeGroup,...
                                 'Style','radiobutton',...
                                 'String','From',...
                                 'Value',0,...
                                 'Tag','loadrange_radiobutton_2',...
                                 'Position',[0 10 100 20]);

hdl.loadRangeStartText = uicontrol(hdl.mainFig,...
                                   'Style','edit',...
                                   'String','1',...
                                   'Tag','loadrange_start_text',...
                                   'Position',[80 loadRangePos-15 30 25]);

hdl.loadRangeToHeadline = uicontrol(hdl.mainFig,...
                               'Style','text',...
                               'String','to',...
                               'Position',[112 loadRangePos-20 15 25]);

hdl.loadRangeEndText = uicontrol(hdl.mainFig,...
                                 'Style','edit',...
                                 'String','100',...
                                 'Tag','loadrange_end_text',...
                                 'Position',[130 loadRangePos-15 30 25]);

hdl.loadStepHeadline = uicontrol(hdl.mainFig,...
                                 'Style','text',...
                                 'String','# frame per step',...
                                 'Position',[10 loadRangePos-50 150 25]);

hdl.loadStepText = uicontrol(hdl.mainFig,...
                             'Style','edit',...
                             'String','1',...
                             'Position',[140 loadRangePos-50 30 25]);

% hdl.RoiIdentfierHeadline = uicontrol(hdl.mainFig,...
%                                  'Style','text',...
%                                  'String','Roi-file identifier',...
%                                  'Position',[160 loadRangePos-100 150 25]);
% 
% hdl.RoiIdentfierText = uicontrol(hdl.mainFig,...
%                              'Style','edit',...
%                              'String','_RoiArray',...
%                              'Position',[280 loadRangePos-95 100 25]);

hdl.fileListBox = uicontrol(hdl.mainFig,...
                            'Style','listbox',...
                            'Position',[220 loadRangePos-55 300 200],...
                            'FontSize',16);

hdl.importRawDataButton = uicontrol(hdl.mainFig,...
                             'Style','pushbutton',...
                             'String','Import',...
                             'Position',[400 loadRangePos-95 100 30],...
                             'FontSize',16);
% tabcontrol part for different "modes"
tabcontBotOffset= -15+GeneralBotOffset;
tabcontHeight= 370;
hdl.tabgp = uitabgroup(hdl.mainFig,"Units","pixels",'Position',[10 tabcontBotOffset 530 tabcontHeight]);

hdl.tabSetupA = uitab(hdl.tabgp,'Title','Setup A');
hdl.tabSetupC = uitab(hdl.tabgp,'Title','Setup C');
%% SetupAtab
% dF/F map
responseHPos = tabcontHeight-75;%310(+GeneralBotOffset) before
hdl.responseMapHeadline = uicontrol(hdl.tabSetupA,...
                                    'Style','text',...
                                    'String','dF/F Map Options',...
                                    'Position',[10 responseHPos+20 150 25],...
                                    'FontWeight','bold');


hdl.resIntensityOffsetHead = uicontrol(hdl.tabSetupA,...
                                    'Style','text',...
                                    'String','offset',...
                                    'Position',[10 responseHPos-5 50 25]);
                          
hdl.resIntensityOffsetText = uicontrol(hdl.tabSetupA,...
                               'Style','edit',...
                               'String','-30',...
                               'Position',[60 responseHPos 30 25]);

hdl.resFZeroHead = uicontrol(hdl.tabSetupA,...
                          'Style','text',...
                          'String','F0 window',...
                          'Position',[105 responseHPos-5 80 25]);

hdl.resFZeroStartText = uicontrol(hdl.tabSetupA,...
                               'Style','edit',...
                               'String','1',...
                               'Tag','resFZero_start_text',...
                               'Position',[180 responseHPos 30 25]);

hdl.resFZeroToHeadline = uicontrol(hdl.tabSetupA,...
                                'Style','text',...
                                'String','to',...
                                'Position',[220 responseHPos-5 15 25]);

hdl.resFZeroEndText = uicontrol(hdl.tabSetupA,...
                             'Style','edit',...
                             'String','100',...
                             'Tag','resFZero_end_text',...
                             'Position',[240 responseHPos 30 25]);

hdl.responseWindowHead = uicontrol(hdl.tabSetupA,...
                          'Style','text',...
                          'String','dF window',...
                          'Position',[300 responseHPos-5 80 25]);

hdl.responseStartText = uicontrol(hdl.tabSetupA,...
                               'Style','edit',...
                               'String','1',...
                               'Tag','response_start_text',...
                               'Position',[370 responseHPos 30 25]);

hdl.responseToHeadline = uicontrol(hdl.tabSetupA,...
                                'Style','text',...
                                'String','to',...
                                'Position',[410 responseHPos-5 15 25]);

hdl.responseEndText = uicontrol(hdl.tabSetupA,...
                             'Style','edit',...
                             'String','100',...
                             'Tag','response_end_text',...
                             'Position',[430 responseHPos 30 25]);

hdl.addResponseMapButton = uicontrol(hdl.tabSetupA,...
                                     'String','add dF/F map',...
                                     'Tag','addMapButton_response',...
                                     'Position',[20 responseHPos-35 100 30]);

hdl.updateResponseMapButton = uicontrol(hdl.tabSetupA,...
                                     'String','update dF/F map',...
                                     'Tag','updateMapButton_response',...
                                     'Position',[160 responseHPos-35 100 30]);


% max dF/F map
rmaxHPos =tabcontHeight-160 ; %220 before
hdl.responseMaxMapHeadline = uicontrol(hdl.tabSetupA,...
                                    'Style','text',...
                                    'String','Max dF/F Map Options',...
                                    'Position',[10 rmaxHPos+20 180 25],...
                                    'FontWeight','bold');

hdl.rmaxIntensityOffsetHead = uicontrol(hdl.tabSetupA,...
                                    'Style','text',...
                                    'String','offset',...
                                    'Position',[10 rmaxHPos-5 50 25]);
                          
hdl.rmaxIntensityOffsetText = uicontrol(hdl.tabSetupA,...
                               'Style','edit',...
                               'String','-30',...
                               'Position',[60 rmaxHPos 30 25]);

hdl.rmaxFZeroHead = uicontrol(hdl.tabSetupA,...
                          'Style','text',...
                          'String','F0 window',...
                          'Position',[90 rmaxHPos-5 80 25]);

hdl.rmaxFZeroStartText = uicontrol(hdl.tabSetupA,...
                               'Style','edit',...
                               'String','1',...
                               'Tag','rmaxFZero_start_text',...
                               'Position',[180 rmaxHPos 30 25]);

hdl.rmaxFZeroToHeadline = uicontrol(hdl.tabSetupA,...
                                'Style','text',...
                                'String','to',...
                                'Position',[220 rmaxHPos-5 15 25]);

hdl.rmaxFZeroEndText = uicontrol(hdl.tabSetupA,...
                             'Style','edit',...
                             'String','100',...
                             'Tag','rmaxFZero_end_text',...
                             'Position',[240 rmaxHPos 30 25]);

hdl.rmaxSlidingWindowHead = uicontrol(hdl.tabSetupA,...
                          'Style','text',...
                          'String','sliding window size',...
                          'Position',[290 rmaxHPos-5 120 25]);

hdl.rmaxSlidingWindowText = uicontrol(hdl.tabSetupA,...
                               'Style','edit',...
                               'String','1',...
                               'Position',[400 rmaxHPos 30 25]);

% inCremcfg.ButtonSide = 'left';
% inCremcfg.ButtonWidth = 'half';
% inCremcfg.Position = 'default';
% inCremcfg.Range = [1,inf];
% hdl.rmaxSlidingWindowInc = helper.incrementdecrement(hdl.rmaxSlidingWindowText,...
%                                                   inCremcfg,...
%                                                   hdl.mainFig,'Units','points',...
%                                                   'Position', [0 0 20 20]);

hdl.addResponseMaxMapButton = uicontrol(hdl.tabSetupA,...
                                     'String','add max dF/F map',...
                                     'Tag','addMapButton_responseMax',...
                                     'Position',[20 rmaxHPos-35 100 30]);

hdl.updateResponseMaxMapButton = uicontrol(hdl.tabSetupA,...
                                     'String','update max dF/F map',...
                                     'Tag','updateMapButton_responseMax',...
                                     'Position',[160 rmaxHPos-35 110 30]);

lftHPos = tabcontHeight-375;%-15 before
hdl.loadFileTypeHeadline = uicontrol(hdl.tabSetupA,...
                                 'Style','text',...
                                 'String','Load file type',...
                                 'Position',[-10 lftHPos+140 150 25]);

hdl.loadFileTypeGroup = uibuttongroup(hdl.tabSetupA,'Units','pixels',...
                                   'Position', [25 lftHPos+65 80 80]);

hdl.loadFileTypeRadio1 = uicontrol(hdl.loadFileTypeGroup,...
                                 'Style','radiobutton',...
                                 'String','Binned',...
                                 'Value',1,...
                                 'Tag','loadfiletype_radio_1',...
                                 'Position',[0 50 100 20]);

hdl.loadFileTypeRadio2 = uicontrol(hdl.loadFileTypeGroup,...
                                 'Style','radiobutton',...
                                 'String','Raw',...
                                 'Value',0,...
                                 'Tag','loadfiletype_radio_2',...
                                 'Position',[0 20 100 20]);

hdl.planeNumHeadline = uicontrol(hdl.mainFig,...
                                 'Style','text',...
                                 'String','Plane no.',...
                                 'Position',[10 370+GeneralBotOffset 150 25]);

hdl.planeNumText = uicontrol(hdl.mainFig,...
                             'Style','edit',...
                             'String','1',...
                             'Position',[140 370+GeneralBotOffset 30 25]);

%% SetupCtab
%TODO:Change tags!
% df/F map
SetupCHPos = tabcontHeight-75;%310(+GeneralBotOffset) before
SetupCLPos = 180;
hdl.SetupCMapHeadline = uicontrol(hdl.tabSetupC,...
                                    'Style','text',...
                                    'String','SetupC Options',...
                                    'Position',[10 SetupCHPos+20 150 25],...
                                    'FontWeight','bold');


hdl.SetupCSkippingHead = uicontrol(hdl.tabSetupC,...
                                    'Style','text',...
                                    'String','skipping ',...
                                    'Position',[10 SetupCHPos-5 50 25]);
                          
hdl.SetupCSkippingText = uicontrol(hdl.tabSetupC,...
                               'Style','edit',...
                               'String','5',...
                               'Position',[60 SetupCHPos 30 25]);

hdl.SetupCSkippingHead2 = uicontrol(hdl.tabSetupC,...
                                    'Style','text',...
                                    'String','frames',...
                                    'Position',[90 SetupCHPos-5 50 25]);

hdl.SetupCaddResponseMapButton = uicontrol(hdl.tabSetupC,...
                                     'String','add dF/F map',...
                                     'Tag','addMapButton_SetupCResponse',...
                                     'Position',[20+SetupCLPos SetupCHPos-5 100 30]);

hdl.SetupCupdateResponseMapButton = uicontrol(hdl.tabSetupC,...
                                     'String','update dF/F map',...
                                     'Tag','updateMapButton_SetupCResponse',...
                                     'Position',[140+SetupCLPos SetupCHPos-5 110 30]);
%df/f max map
hdl.SetupCPercentileHead = uicontrol(hdl.tabSetupC,...
                                    'Style','text',...
                                    'String','Using lower ',...
                                    'Position',[10 SetupCHPos-40 50 25]);
                          
hdl.SetupCPercentileText = uicontrol(hdl.tabSetupC,...
                               'Style','edit',...
                               'String','25',...
                               'Position',[60 SetupCHPos-40 30 25]);

hdl.SetupCPercentileHead2 = uicontrol(hdl.tabSetupC,...
                                    'Style','text',...
                                    'String','percentile as baseline',...
                                    'Position',[95 SetupCHPos-40 70 25]);

hdl.SetupCaddMaxResponseMapButton = uicontrol(hdl.tabSetupC,...
                                     'String','add dF/F Max map',...
                                     'Tag','addMapButton_SetupCResponseMax',...
                                     'Position',[20+SetupCLPos SetupCHPos-40 100 30]);

hdl.SetupCMaxupdateResponseMapButton = uicontrol(hdl.tabSetupC,...
                                     'String','update dF/F Max map',...
                                     'Tag','updateMapButton_SetupCResponseMax',...
                                     'Position',[140+SetupCLPos SetupCHPos-40 110 30]);
%local correlation map
hdl.SetupCaddCorrMapButton = uicontrol(hdl.tabSetupC,...
                                     'String','add local corr. map',...
                                     'Tag','addMapButton_SetupCCorr',...
                                     'Position',[20+SetupCLPos SetupCHPos-75 100 30]);

hdl.SetupCupdateCorrMapButton = uicontrol(hdl.tabSetupC,...
                                     'String','update local corr. map',...
                                     'Tag','updateMapButton_SetupCCorr',...
                                     'Position',[140+SetupCLPos SetupCHPos-75 110 30]);
hdl.SetupCOffsetHead = uicontrol(hdl.tabSetupC,...
                                    'Style','text',...
                                    'String','offset ',...
                                    'Position',[10 SetupCHPos-80 50 25]);
                          
hdl.SetupCoffsetText = uicontrol(hdl.tabSetupC,...
                               'Style','edit',...
                               'String','0',...
                               'Position',[60 SetupCHPos-75 30 25]);

hdl.rmaxSlidingWindowSetupCHead = uicontrol(hdl.tabSetupC,...
                          'Style','text',...
                          'String','sliding window size',...
                          'Position',[10 SetupCHPos-110 50 25]);

hdl.rmaxSlidingWindowSetupCText = uicontrol(hdl.tabSetupC,...
                               'Style','edit',...
                               'String','2',...
                               'Position',[60 SetupCHPos-110 30 25]);
%extract time traces
hdl.SetupCExtractTracesDfoverfButton = uicontrol(hdl.tabSetupC,...
                                     'String','extract df/f timetraces of a transformation',...
                                     'Tag','Button_extracttraces_dfoverfSetupC',...
                                     'Position',[20+SetupCLPos SetupCHPos-115 200 30]);


%% BUnwarpJ part

BUnwarpJlftPos= 150;
BUnwarpJBtmPos= -25+GeneralBotOffset;


hdl.BUnwarpJHeadline = uicontrol(hdl.mainFig,...
                                 'Style','text',...
                                 'String','Non-rigid inter trial transformation (BUnwarpJ)',...
                                 'FontWeight','bold',...
                                 'Position',[BUnwarpJlftPos-15 BUnwarpJBtmPos+145 250 25]);

hdl.BUnwarpJGroup = uibuttongroup('Units','pixels',...
                                   'Position', [BUnwarpJlftPos-10 BUnwarpJBtmPos+10 400 140]);

hdl.BUnwarpJReferencetrialText = uicontrol(hdl.mainFig,...
                                 'Style','text',...
                                 'String','Reference trial',...
                                 'Position',[BUnwarpJlftPos+155 BUnwarpJBtmPos+120 100 25]);
hdl.BUnwarpJReferencetrial = uicontrol(hdl.mainFig,...
                                      "Style","popupmenu",...
                                      "String",{'Nothing loaded1','Nothing loaded2','Nothing loaded3'},...
                                      'Tag','Referncetrial_popupmenu',...
                                      'Position',[BUnwarpJlftPos+170 BUnwarpJBtmPos+100 200 30]);
hdl.RoiIdentfierHeadline = uicontrol(hdl.mainFig,...
                                 'Style','text',...
                                 'String','Roi-file identifier',...
                                 'Position',[BUnwarpJlftPos+280 BUnwarpJBtmPos+80 100 25]);

hdl.RoiIdentfierText = uicontrol(hdl.mainFig,...
                             'Style','edit',...
                             'String','_RoiArray',...
                             'Position',[BUnwarpJlftPos+280 BUnwarpJBtmPos+60 100 25]);

hdl.BUnwarpJTransformationName = uicontrol(hdl.mainFig,...
                                      "Style","edit",...
                                      'String','Change transformation name',...
                                      'Tag','TransformationName_edit',...
                                      'Position',[BUnwarpJlftPos+5 BUnwarpJBtmPos+125 150 20]);
hdl.BUnwarpJCalculateButton = uicontrol(hdl.mainFig,...
                                     'String','Calculate BUnwarpJ',...
                                     'Tag','Calculate_BUnwarpJ_Button',...
                                     'Position',[BUnwarpJlftPos+5 BUnwarpJBtmPos+90 110 30]);
hdl.BUnwarpJPara = uicontrol(hdl.mainFig,...
                                      "Style","pushbutton",...
                                      'Tag','BUnwarpJPara_button',...
                                      'BackgroundColor','white',...
                                      'CData',imresize(imread("+icons/gear16.png"),[19 19]),...
                                      'Position',[BUnwarpJlftPos+120 BUnwarpJBtmPos+91 28 28]);
hdl.BUnwarpJUseSIFT = uicontrol(hdl.mainFig,...
                                      "Style","checkbox",...
                                      "String",'Use SIFT',...
                                      'Tag','SIFT_checkbox',...
                                      'Position',[BUnwarpJlftPos+170 BUnwarpJBtmPos+90 90 20]);
hdl.BUnwarpJSIFTPara = uicontrol(hdl.mainFig,...
                                      "Style","pushbutton",...
                                      'Tag','SIFTPara_button',...
                                      'BackgroundColor','white',...
                                      'CData',imresize(imread("+icons/gear16.png"),[13 13]),...
                                      'Position',[BUnwarpJlftPos+250 BUnwarpJBtmPos+88 20 20]);

hdl.BUnwarpJNormTypeGroup = uibuttongroup('Units','pixels',...
                                   'Position', [BUnwarpJlftPos+170 BUnwarpJBtmPos+15 100 70]);

hdl.BUnwarpJCLAHEPara = uicontrol(hdl.mainFig,...
                                      "Style","pushbutton",...
                                      'Tag','CLAHEPara_button',...
                                      'BackgroundColor','white',...
                                      'CData',imresize(imread("+icons/gear16.png"),[13 13]),...
                                      'Position',[BUnwarpJlftPos+230 BUnwarpJBtmPos+40 20 20]);

hdl.BUnwarpJUseNormEqual  = uicontrol(hdl.BUnwarpJNormTypeGroup,...
                                      "Style","radiobutton",...
                                      "String",'Histogram equal.',...
                                      'Value',0,...
                                      'Tag','Norm_HistoEqu_radiobutton',...
                                      'Position',[0 50 100 20]);
hdl.BUnwarpJUseNormCLAHE  = uicontrol(hdl.BUnwarpJNormTypeGroup,...
                                      "Style","radiobutton",...
                                      "String",'CLAHE',...
                                      'Value',0,...
                                      'Tag','Norm_CLAHE_radiobutton',...
                                      'Position',[0 25 75 20]);

hdl.BUnwarpJUseNormNone  = uicontrol(hdl.BUnwarpJNormTypeGroup,...
                                      "Style","radiobutton",...
                                      "String",'none',...
                                      'Value',1,...
                                      'Tag','Norm_none_radiobutton',...
                                      'Position',[0 0 100 20]);
% hdl.BUnwarpJCalculatedLEDText  = uicontrol(hdl.mainFig,...
%                                       'Style','text',...
%                                       "String",'calculated',...
%                                       'Tag','BUnwarpJCalculatedLEDText',...
%                                       'Position',[BUnwarpJlftPos+125 72 60 15]);
% hdl.BUnwarpJCalculatedLED  = uicontrol(hdl.mainFig,...
%                                       'Style','text',...
%                                       "String",'    ',...
%                                       'BackgroundColor',"red",...
%                                       'Tag','BUnwarpJCalculatedLED',...
%                                       'Position',[BUnwarpJlftPos+150 56 15 15]);
hdl.BUnwarpJCalculatedTransformations = uicontrol(hdl.mainFig,...
                                      "Style","popupmenu",...
                                      "String",{'Nothing calculated1','Nothing calculated2','Nothing calculated3'},...
                                      'Tag','CalculatedTransformations_popupmenu',...
                                      'Position',[BUnwarpJlftPos+5 BUnwarpJBtmPos+60 120 15]);
hdl.BUnwarpJInspectTrialsButton  = uicontrol(hdl.mainFig,...
                                      "String",'Inspect trials and rois',...
                                      'Tag','Inspect_BUnwarpJ',...
                                      'Position',[BUnwarpJlftPos+5 BUnwarpJBtmPos+20 120 30]);




